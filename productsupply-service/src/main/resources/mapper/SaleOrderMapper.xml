<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.zq.dao.SaleOrderMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.zq.pojo.SaleOrder">
        <id column="id" property="id" />
        <result column="code" property="code" />
        <result column="user_id" property="userId" />
        <result column="customer_id" property="customerId" />
        <result column="order_type" property="orderType" />
        <result column="input_require_date" property="inputRequireDate" />
        <result column="out_require_date" property="outRequireDate" />
        <result column="order_date" property="orderDate" />
        <result column="settlement_method" property="settlementMethod" />
        <result column="amount" property="amount" />
        <result column="tax_rate" property="taxRate" />
        <result column="discount" property="discount" />
        <result column="delivery_status" property="deliveryStatus" />
        <result column="receipt_status" property="receiptStatus" />
        <result column="order_status" property="orderStatus" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
        <collection property="saleOrderDetails" ofType="cn.zq.pojo.SaleOrderDetail" javaType="java.util.List">
            <id column="id" property="id" />
            <result column="code" property="code" />
            <result column="order_id" property="orderId" />
            <result column="order_code" property="orderCode" />
            <result column="material_code" property="materialCode" />
            <result column="count" property="count" />
            <result column="price_including_tax" property="priceIncludingTax" />
            <result column="amount_including_tax" property="amountIncludingTax" />
            <result column="tax_rate" property="taxRate" />
            <result column="packing_specification" property="packingSpecification" />
            <result column="packing_requirement" property="packingRequirement" />
            <result column="remark" property="remark" />
            <result column="delivered_count" property="deliveredCount" />
            <result column="create_time" property="createTime"/>
            <result column="update_time" property="updateTime" />
        </collection>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, code, customer_id, order_type, input_require_date,out_require_date, order_date, settlement_method, attachment, amount, tax_rate, discount, delivery_status, receipt_status, create_time, update_time
    </sql>
    <select id="maxId" resultType="java.lang.Integer" >
        select max(id) from sale_order
    </select>
    <select id="selectByCode" resultMap="BaseResultMap" parameterType="java.lang.String">
        select
        <include refid="Base_Column_List" />
        from sale_order
        where code=#{code}
    </select>
    <insert id="insertSaleOrder" parameterType="cn.zq.pojo.SaleOrder">
        insert into sale_order
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="id!=null">
                id,
            </if>
            <if test="code!=null">
              code,
            </if>
            <if test="customerId!=null">
                customer_id,
            </if>
            <if test="orderType!=null">
                order_type,
            </if>
            <if test="inputRequireDate!=null">
                input_require_date,
            </if>
            <if test="outRequireDate!=null">
                out_require_date,
            </if>
            <if test="orderDate!=null">
                order_date,
            </if>
            <if test="settlementMethod!=null">
                settlement_method,
            </if>
            <if test="amount!=null">
                amount,
            </if>
            <if test="taxRate!=null">
                tax_rate,
            </if>
            <if test="discount!=null">
                discount,
            </if>
            <if test="deliveryStatus!=null">
                delivery_status,
            </if>
            <if test="receiptStatus!=null">
                receipt_status,
            </if>
            <if test="orderStatus!=null">
                order_status,
            </if>
            <if test="createTime!=null">
                create_time,
            </if>
            <if test="updateTime!=null">
                update_time,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="id!=null">
                #{id},
            </if>
            <if test="code!=null">
                #{code},
            </if>
            <if test="customerId!=null">
                #{customerId},
            </if>
            <if test="orderType!=null">
                #{orderType},
            </if>
            <if test="inputRequireDate!=null">
                #{inputRequireDate},
            </if>
            <if test="outRequireDate!=null">
                #{outRequireDate},
            </if>
            <if test="orderDate!=null">
                #{orderDate},
            </if>
            <if test="settlementMethod!=null">
                #{settlementMethod},
            </if>
            <if test="amount!=null">
                #{amount},
            </if>
            <if test="taxRate!=null">
                #{taxRate},
            </if>
            <if test="discount!=null">
                #{discount},
            </if>
            <if test="deliveryStatus!=null">
                #{deliveryStatus},
            </if>
            <if test="receiptStatus!=null">
                #{receiptStatus},
            </if>
            <if test="orderStatus!=null">
                #{orderStatus},
            </if>
            <if test="createTime!=null">
                #{createTime},
            </if>
            <if test="updateTime!=null">
                #{updateTime},
            </if>
        </trim>
    </insert>
    <select id="selectAll" resultMap="BaseResultMap">
        select so.*,sod.* from sale_order so
         left join sale_order_detail sod
         on sod.order_code=so.code
    </select>
</mapper>
